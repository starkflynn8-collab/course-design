{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nexport default {\n  name: \"Goods\",\n  data() {\n    return {\n      currUser: JSON.parse(localStorage.getItem(\"currUser\")),\n      uId: JSON.parse(localStorage.getItem(\"currUser\"))?.uid || null,\n      drawerEdit: false,\n      drawerAdd: false,\n      adding: false,\n      // 提交时加载状态\n      fileList: [],\n      // 上传组件的文件列表\n      uploadFile: null,\n      // 当前选择的图片文件\n      previewVisible: false,\n      // 预览弹窗\n      goodsItem: {\n        gName: '',\n        gPrice: null,\n        gCount: null,\n        gContent: '',\n        gLevel: 4,\n        gContact: '',\n        college: '',\n        campus: '',\n        subject: '',\n        type: ''\n      },\n      previewUrl: '',\n      token: localStorage.getItem(\"token\"),\n      gName: null,\n      gPrice: null,\n      gContent: null,\n      currentPage: 1,\n      pageLimits: [10, 20, 30, 40],\n      limit: 10,\n      ids: [],\n      itemTotal: 10,\n      goods: [],\n      apiBase: 'http://localhost:8888'\n    };\n  },\n  created() {\n    this.getGoods(); // 页面加载时显示当前用户商品\n  },\n\n  methods: {\n    getImageUrl(gimage) {\n      if (!gimage) return '';\n      if (gimage.startsWith('http')) return gimage;\n      return this.apiBase + gimage;\n    },\n    handleImgError(e) {\n      e.target.src = this.apiBase + '/upload/default-book.jpg';\n    },\n    handleClose(done) {\n      this.goodsItem = {};\n      done();\n    },\n    handleSelectionChange(val) {\n      this.ids.length = 0;\n      val.forEach(item => {\n        this.ids.push(item.gId);\n      });\n    },\n    getGoods() {\n      console.log('强制重新请求商品数据'); // 加这行\n      this.axios.get(\"http://localhost:8888/goods/search\", {\n        params: {\n          gName: this.gName,\n          gPrice: this.gPrice,\n          gContent: this.gContent,\n          uId: this.uId,\n          page: this.currentPage,\n          limit: this.limit,\n          t: new Date().getTime() // 加这行！强制不缓存\n        }\n      }).then(resp => {\n        console.log('后端返回数据:', resp.data); // 加这行！打印真实数据\n        if (resp.data.message === \"ok\" || resp.data.code === 200) {\n          this.itemTotal = resp.data.data.total || resp.data.data.totalRecords;\n          this.goods = resp.data.data.records || resp.data.data.list;\n        }\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n    handleSizeChange(limit) {\n      this.limit = limit;\n      this.currentPage = 1;\n      this.getGoods();\n    },\n    handleCurrentChange(val) {\n      this.currentPage = val;\n      this.getGoods();\n    },\n    search() {\n      this.currentPage = 1;\n      this.getGoods();\n    },\n    handleEdit(index, row) {\n      // 深拷贝，避免直接修改表格数据\n      this.goodsItem = {\n        ...row\n      };\n      this.drawerEdit = true;\n    },\n    handleDelete(index, row) {\n      this.goodsItem = row;\n      this.$confirm(\"删除商品后不可恢复, 是否继续?\", \"提示\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\"\n      }).then(() => {\n        const params = new URLSearchParams();\n        params.append(\"token\", this.token);\n        params.append(\"gid\", this.goodsItem.gid);\n        this.axios.post(\"http://localhost:8888/goods/delete\", params, {\n          headers: {\n            \"Content-Type\": \"application/x-www-form-urlencoded\"\n          }\n        }).then(resp => {\n          this.$message.success(resp.data.message || \"删除成功\");\n          this.getGoods();\n        }).catch(error => {\n          console.error(error);\n          this.$message.error(\"删除失败\");\n        });\n      }).catch(() => {\n        this.$message.info(\"已取消删除\");\n      });\n    },\n    submitEdit() {\n      const params = new URLSearchParams();\n      params.append(\"token\", this.token);\n      params.append(\"gId\", this.goodsItem.gId);\n      params.append(\"gName\", this.goodsItem.gName);\n      params.append(\"gPrice\", this.goodsItem.gPrice);\n      params.append(\"gCount\", this.goodsItem.gCount);\n      params.append(\"gContent\", this.goodsItem.gContent || \"\");\n      params.append(\"gImage\", this.goodsItem.gImage || \"\");\n      params.append(\"uId\", this.goodsItem.uId);\n      params.append(\"gLevel\", this.goodsItem.gLevel || 0);\n      params.append(\"gContact\", this.goodsItem.gContact || \"\");\n      params.append(\"college\", this.goodsItem.college);\n      params.append(\"campus\", this.goodsItem.campus);\n      params.append(\"subject\", this.goodsItem.subject);\n      params.append(\"type\", this.goodsItem.type);\n      this.axios.post(\"http://localhost:8888/goods/update\", params, {\n        headers: {\n          \"Content-Type\": \"application/x-www-form-urlencoded\"\n        }\n      }).then(resp => {\n        this.$message.success(resp.data.message || \"修改成功\");\n        this.drawerEdit = false;\n        this.getGoods();\n      }).catch(error => {\n        console.error(error);\n        this.$message.error(\"修改失败\");\n      }).finally(() => {\n        this.goodsItem = {};\n      });\n    },\n    addGoods() {\n      // 重置表单和上传状态\n      this.goodsItem = {\n        gName: \"\",\n        gPrice: null,\n        gCount: null,\n        gContent: \"\",\n        gLevel: 4,\n        gContact: \"\",\n        college: \"\",\n        campus: \"\",\n        subject: \"\",\n        type: \"\"\n      };\n      this.fileList = [];\n      this.uploadFile = null;\n      this.drawerAdd = true;\n    },\n    // el-upload 相关方法\n    handleFileChange(file, fileList) {\n      this.uploadFile = file.raw; // 保存原始文件对象\n      this.fileList = fileList.slice(-1); // 限制只保留最后一张（最多1张）\n    },\n\n    handleRemove() {\n      this.uploadFile = null;\n      this.fileList = [];\n    },\n    handlePreview(file) {\n      this.previewUrl = file.url;\n      this.previewVisible = true;\n    },\n    submitAdd() {\n      // 基础校验\n      if (!this.goodsItem.gName || this.goodsItem.gPrice === null || this.goodsItem.gCount === null) {\n        this.$message.error(\"请填写商品名称、价格和数量\");\n        return;\n      }\n      this.adding = true;\n      const formData = new FormData();\n      formData.append(\"token\", this.token);\n      formData.append(\"gName\", this.goodsItem.gName);\n      formData.append(\"gPrice\", this.goodsItem.gPrice);\n      formData.append(\"gCount\", this.goodsItem.gCount);\n      formData.append(\"gContent\", this.goodsItem.gContent || \"\");\n      formData.append(\"gLevel\", this.goodsItem.gLevel || 4);\n      formData.append(\"gContact\", this.goodsItem.gContact);\n      formData.append(\"college\", this.goodsItem.college);\n      formData.append(\"campus\", this.goodsItem.campus);\n      formData.append(\"subject\", this.goodsItem.subject);\n      formData.append(\"type\", this.goodsItem.type);\n      if (this.uploadFile) {\n        formData.append(\"gImageFile\", this.uploadFile);\n      }\n      this.axios.post(\"http://localhost:8888/goods/add\", formData, {\n        headers: {\n          \"Content-Type\": \"multipart/form-data\"\n        }\n      }).then(resp => {\n        if (resp.data.code === 200 || resp.data.message.includes(\"成功\")) {\n          this.$message.success(\"商品发布成功！\");\n          this.drawerAdd = false;\n          this.getGoods();\n        } else {\n          this.$message.error(resp.data.message || \"发布失败\");\n        }\n      }).catch(error => {\n        console.error(error);\n        this.$message.error(\"上传失败，请检查网络或图片大小\");\n      }).finally(() => {\n        this.adding = false;\n        this.goodsItem = {};\n      });\n    },\n    deleteIds() {\n      if (this.ids.length === 0) {\n        this.$message.error(\"请先选择要删除的商品\");\n        return;\n      }\n      this.$confirm(`确定批量删除这 ${this.ids.length} 件商品吗？`, \"提示\", {\n        type: \"warning\"\n      }).then(() => {\n        const params = new URLSearchParams();\n        params.append(\"token\", this.token);\n        this.ids.forEach(id => params.append(\"listId\", id));\n        this.axios.post(\"http://localhost:8888/goods/deleteById\", params, {\n          headers: {\n            \"Content-Type\": \"application/x-www-form-urlencoded\"\n          }\n        }).then(resp => {\n          this.$message.success(resp.data.message || \"批量删除成功\");\n          this.getGoods();\n        }).catch(error => {\n          console.error(error);\n          this.$message.error(\"批量删除失败\");\n        });\n      }).catch(() => {\n        this.$message.info(\"已取消批量删除\");\n      });\n    }\n  }\n};","map":{"version":3,"names":["name","data","currUser","JSON","parse","localStorage","getItem","uId","uid","drawerEdit","drawerAdd","adding","fileList","uploadFile","previewVisible","goodsItem","gName","gPrice","gCount","gContent","gLevel","gContact","college","campus","subject","type","previewUrl","token","currentPage","pageLimits","limit","ids","itemTotal","goods","apiBase","created","getGoods","methods","getImageUrl","gimage","startsWith","handleImgError","e","target","src","handleClose","done","handleSelectionChange","val","length","forEach","item","push","gId","console","log","axios","get","params","page","t","Date","getTime","then","resp","message","code","total","totalRecords","records","list","catch","error","handleSizeChange","handleCurrentChange","search","handleEdit","index","row","handleDelete","$confirm","confirmButtonText","cancelButtonText","URLSearchParams","append","gid","post","headers","$message","success","info","submitEdit","gImage","finally","addGoods","handleFileChange","file","raw","slice","handleRemove","handlePreview","url","submitAdd","formData","FormData","includes","deleteIds","id"],"sources":["src/views/Goods/index.vue"],"sourcesContent":["<template>\n  <div>\n    <div style=\"padding-bottom: 20px\">\n      <el-input\n        placeholder=\"搜索商品名\"\n        v-model=\"gName\"\n        clearable\n        style=\"width: 150px\"\n      >\n      </el-input>\n      <el-input\n        placeholder=\"搜索商品价格\"\n        v-model=\"gPrice\"\n        clearable\n        style=\"width: 150px\"\n      >\n      </el-input>\n      <el-input\n        placeholder=\"搜索商品描述\"\n        v-model=\"gContent\"\n        clearable\n        style=\"width: 150px\"\n      >\n      </el-input>\n      <el-button type=\"primary\" @click=\"search\">搜索</el-button>\n    </div>\n    <div>\n      <el-button type=\"primary\" size=\"small\" @click=\"addGoods\">添加</el-button>\n      <el-button type=\"danger\" size=\"small\" @click=\"deleteIds\"\n        >批量删除</el-button\n      >\n    </div>\n    <el-table\n      ref=\"multipleTable\"\n      :data=\"goods\"\n      tooltip-effect=\"dark\"\n      style=\"width: 100%\"\n      @selection-change=\"handleSelectionChange\"\n    >\n      <el-table-column prop=\"gId\" label=\"商品ID\" width=\"120\" sortable></el-table-column>\n      <el-table-column prop=\"gname\" label=\"商品名\" width=\"120\"></el-table-column>\n      <el-table-column prop=\"gcount\" label=\"商品数量\" width=\"120\" sortable></el-table-column>\n      <el-table-column prop=\"gprice\" label=\"商品价格\" width=\"120\" sortable></el-table-column>\n      <el-table-column prop=\"gcontent\" label=\"商品描述\" show-overflow-tooltip></el-table-column>\n\n      <el-table-column prop=\"glevel\" label=\"商品评价\" width=\"120\" sortable></el-table-column>\n      <el-table-column prop=\"uid\" label=\"卖家ID\" width=\"120\" sortable></el-table-column>\n      <el-table-column\n          prop=\"gcontact\"\n          label=\"联系方式\"\n          width=\"150\"\n          show-overflow-tooltip\n      ></el-table-column>\n\n      <el-table-column label=\"商品图片\" width=\"120\" align=\"center\">\n        <template slot-scope=\"scope\">\n          <img\n              v-if=\"scope.row.gimage\"\n              :src=\"getImageUrl(scope.row.gimage)\"\n              style=\"width: 80px; height: 80px; object-fit: cover; border-radius: 4px; border: 1px solid #eee;\"\n              @error=\"handleImgError($event)\"\n          />\n          <span v-else style=\"color: #999;\">无图片</span>\n        </template>\n      </el-table-column>\n\n\n\n      <el-table-column label=\"操作\">\n        <template slot-scope=\"scope\">\n          <el-button size=\"mini\" @click=\"handleEdit(scope.$index, scope.row)\"\n            >编辑</el-button\n          >\n          <el-button\n            size=\"mini\"\n            type=\"danger\"\n            @click=\"handleDelete(scope.$index, scope.row)\"\n            >删除</el-button\n          >\n        </template>\n      </el-table-column>\n    </el-table>\n    <el-pagination\n      @size-change=\"handleSizeChange\"\n      @current-change=\"handleCurrentChange\"\n      :current-page=\"currentPage\"\n      :page-sizes=\"pageLimits\"\n      :page-size=\"limit\"\n      layout=\"total, sizes, prev, pager, next, jumper\"\n      :total=\"itemTotal\"\n    >\n    </el-pagination>\n\n    <el-drawer\n      title=\"编辑商品\"\n      :visible.sync=\"drawerEdit\"\n      direction=\"rtl\"\n      :before-close=\"handleClose\"\n    >\n      <div style=\"margin: 10px\">\n        <el-form label-position=\"left\" label-width=\"80px\" :model=\"goodsItem\">\n          <el-form-item label=\"商品名称:\">\n            <el-input\n              v-model=\"goodsItem.gName\"\n              :placeholder=\"goodsItem.gName\"\n            ></el-input>\n          </el-form-item>\n          <el-form-item label=\"所属学院\" prop=\"college\"\n                        :rules=\"[{ required: true, message: '请选择学院' }]\">\n            <el-select v-model=\"goodsItem.college\" placeholder=\"请选择学院\">\n              <el-option label=\"工学\" value=\"工学\"/>\n              <el-option label=\"理学\" value=\"理学\"/>\n              <el-option label=\"经济管理\" value=\"经管\"/>\n              <el-option label=\"人文社科\" value=\"人文\"/>\n              <el-option label=\"医学\" value=\"医学\"/>\n              <el-option label=\"艺术\" value=\"艺术\"/>\n            </el-select>\n          </el-form-item>\n\n          <el-form-item label=\"校区\" prop=\"campus\"\n                        :rules=\"[{ required: true, message: '请选择校区' }]\">\n            <el-select v-model=\"goodsItem.campus\" placeholder=\"请选择校区\">\n              <el-option label=\"九龙湖校区\" value=\"九龙湖\"/>\n              <el-option label=\"四牌楼校区\" value=\"四牌楼\"/>\n              <el-option label=\"丁家桥校区\" value=\"丁家桥\"/>\n            </el-select>\n          </el-form-item>\n\n          <el-form-item label=\"课程类别\" prop=\"subject\">\n            <el-radio-group v-model=\"goodsItem.subject\">\n              <el-radio label=\"通识基础课\"/>\n              <el-radio label=\"专业课\"/>\n            </el-radio-group>\n          </el-form-item>\n\n          <el-form-item label=\"书籍类型\" prop=\"type\">\n            <el-select v-model=\"goodsItem.type\">\n              <el-option label=\"教材\" value=\"教材\"/>\n              <el-option label=\"参考书\" value=\"参考书\"/>\n              <el-option label=\"考研资料\" value=\"考研\"/>\n              <el-option label=\"其他\" value=\"其他\"/>\n            </el-select>\n          </el-form-item>\n\n          <el-form-item label=\"商品价格:\">\n            <el-input\n              v-model=\"goodsItem.gPrice\"\n              :placeholder=\"goodsItem.gPrice\"\n            ></el-input>\n          </el-form-item>\n          <el-form-item label=\"商品数量:\">\n            <el-input\n              v-model=\"goodsItem.gCount\"\n              :placeholder=\"goodsItem.gCount\"\n            ></el-input>\n          </el-form-item>\n          <el-form-item label=\"商品图片:\">\n            <el-input\n              v-model=\"goodsItem.gImage\"\n              :placeholder=\"goodsItem.gImage\"\n            ></el-input>\n          </el-form-item>\n          <el-form-item label=\"商品描述:\">\n            <el-input\n              v-model=\"goodsItem.gContent\"\n              type=\"textarea\"\n              :placeholder=\"goodsItem.gContent\"\n            ></el-input>\n          </el-form-item>\n          <el-form-item\n              label=\"商家联系方式\"\n              prop=\"gContact\"\n              :rules=\"[{ required: true, message: '请输入联系方式' }]\"\n          >\n            <el-input\n                v-model=\"goodsItem.gContact\"\n                placeholder=\"请输入手机号 / 微信号 / QQ\"\n            ></el-input>\n          </el-form-item>\n\n          <el-form-item style=\"display: flex; justify-content: center\">\n            <el-button type=\"primary\" @click=\"submitEdit\">修改</el-button>\n          </el-form-item>\n        </el-form>\n      </div>\n    </el-drawer>\n\n    <el-drawer title=\"添加商品\" :visible.sync=\"drawerAdd\" direction=\"rtl\" size=\"50%\">\n      <div style=\"padding: 20px\">\n        <el-form label-position=\"top\" :model=\"goodsItem\" ref=\"addForm\">\n          <el-form-item label=\"商品名称\" prop=\"gName\" :rules=\"[{ required: true, message: '请输入商品名称' }]\">\n            <el-input v-model=\"goodsItem.gName\" placeholder=\"请输入商品名称（如：高等数学 第7版）\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"所属学院\" prop=\"college\"\n                        :rules=\"[{ required: true, message: '请选择学院' }]\">\n            <el-select v-model=\"goodsItem.college\" placeholder=\"请选择学院\">\n              <el-option label=\"工学\" value=\"工学\"/>\n              <el-option label=\"理学\" value=\"理学\"/>\n              <el-option label=\"经管\" value=\"经管\"/>\n              <el-option label=\"人文\" value=\"人文\"/>\n              <el-option label=\"医学\" value=\"医学\"/>\n              <el-option label=\"艺术\" value=\"艺术\"/>\n            </el-select>\n          </el-form-item>\n\n          <el-form-item label=\"校区\" prop=\"campus\"\n                        :rules=\"[{ required: true, message: '请选择校区' }]\">\n            <el-select v-model=\"goodsItem.campus\" placeholder=\"请选择校区\">\n              <el-option label=\"九龙湖校区\" value=\"九龙湖\"/>\n              <el-option label=\"四牌楼校区\" value=\"四牌楼\"/>\n              <el-option label=\"丁家桥校区\" value=\"丁家桥\"/>\n            </el-select>\n          </el-form-item>\n\n          <el-form-item label=\"课程类别\" prop=\"subject\">\n            <el-radio-group v-model=\"goodsItem.subject\">\n              <el-radio label=\"通识基础课\"/>\n              <el-radio label=\"专业课\"/>\n            </el-radio-group>\n          </el-form-item>\n\n          <el-form-item label=\"书籍类型\" prop=\"type\">\n            <el-select v-model=\"goodsItem.type\">\n              <el-option label=\"教材\" value=\"教材\"/>\n              <el-option label=\"参考书\" value=\"参考书\"/>\n              <el-option label=\"考研资料\" value=\"考研\"/>\n              <el-option label=\"其他\" value=\"其他\"/>\n            </el-select>\n          </el-form-item>\n\n          <el-form-item label=\"商品价格（元）\" prop=\"gPrice\" :rules=\"[{ required: true, message: '请输入价格' }]\">\n            <el-input v-model.number=\"goodsItem.gPrice\" placeholder=\"例如：25.00\"></el-input>\n          </el-form-item>\n\n          <el-form-item label=\"商品数量\" prop=\"gCount\" :rules=\"[{ required: true, message: '请输入数量' }]\">\n            <el-input v-model.number=\"goodsItem.gCount\" placeholder=\"库存数量\"></el-input>\n          </el-form-item>\n\n          <el-form-item label=\"商品成色\" prop=\"gLevel\">\n            <el-rate v-model=\"goodsItem.gLevel\" :texts=\"['很差', '较差', '一般', '良好', '全新']\" show-text></el-rate>\n          </el-form-item>\n\n          <el-form-item label=\"商品描述\" prop=\"gContent\">\n            <el-input\n                v-model=\"goodsItem.gContent\"\n                type=\"textarea\"\n                :rows=\"4\"\n                placeholder=\"描述书籍版本、划线情况、使用痕迹等，越详细越好\"\n            ></el-input>\n          </el-form-item>\n          <el-form-item label=\"联系方式:\">\n            <el-input\n                v-model=\"goodsItem.gContact\"\n                placeholder=\"请输入联系方式\"\n            ></el-input>\n          </el-form-item>\n\n          <el-form-item label=\"上传商品图片（最多1张）\">\n            <el-upload\n                action=\"#\"\n                list-type=\"picture-card\"\n                :auto-upload=\"false\"\n                :limit=\"1\"\n                :on-preview=\"handlePreview\"\n                :on-remove=\"handleRemove\"\n                :on-change=\"handleFileChange\"\n                :file-list=\"fileList\"\n                accept=\"image/*\"\n            >\n              <i class=\"el-icon-plus\"></i>\n            </el-upload>\n            <el-dialog :visible.sync=\"previewVisible\" append-to-body>\n              <img width=\"100%\" :src=\"previewUrl\" alt=\"\" />\n            </el-dialog>\n          </el-form-item>\n\n          <el-form-item style=\"text-align: center; margin-top: 30px\">\n            <el-button @click=\"drawerAdd = false\">取消</el-button>\n            <el-button type=\"primary\" @click=\"submitAdd\" :loading=\"adding\">发布商品</el-button>\n          </el-form-item>\n        </el-form>\n      </div>\n    </el-drawer>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: \"Goods\",\n  data() {\n    return {\n      currUser: JSON.parse(localStorage.getItem(\"currUser\")),\n      uId: JSON.parse(localStorage.getItem(\"currUser\"))?.uid || null,\n      drawerEdit: false,\n      drawerAdd: false,\n      adding: false,              // 提交时加载状态\n      fileList: [],              // 上传组件的文件列表\n      uploadFile: null,          // 当前选择的图片文件\n      previewVisible: false,     // 预览弹窗\n      goodsItem: {\n        gName: '',\n        gPrice: null,\n        gCount: null,\n        gContent: '',\n        gLevel: 4,\n        gContact: '',\n        college: '',\n        campus: '',\n        subject: '',\n        type: ''\n      },\n      previewUrl: '',\n      token: localStorage.getItem(\"token\"),\n      gName: null,\n      gPrice: null,\n      gContent: null,\n      currentPage: 1,\n      pageLimits: [10, 20, 30, 40],\n      limit: 10,\n      ids: [],\n      itemTotal: 10,\n      goods: [],\n      apiBase: 'http://localhost:8888',\n    };\n  },\n  created() {\n    this.getGoods(); // 页面加载时显示当前用户商品\n  },\n\n  methods: {\n    getImageUrl(gimage) {\n      if (!gimage) return '';\n      if (gimage.startsWith('http')) return gimage;\n      return this.apiBase + gimage;\n    },\n    handleImgError(e) {\n      e.target.src = this.apiBase + '/upload/default-book.jpg';\n    },\n    handleClose(done) {\n      this.goodsItem = {};\n      done();\n    },\n    handleSelectionChange(val) {\n      this.ids.length = 0;\n      val.forEach((item) => {\n        this.ids.push(item.gId);\n      });\n    },\n    getGoods() {\n      console.log('强制重新请求商品数据');  // 加这行\n      this.axios\n          .get(\"http://localhost:8888/goods/search\", {\n            params: {\n              gName: this.gName,\n              gPrice: this.gPrice,\n              gContent: this.gContent,\n              uId: this.uId,\n\n              page: this.currentPage,\n              limit: this.limit,\n              t: new Date().getTime()  // 加这行！强制不缓存\n            },\n          })\n          .then((resp) => {\n            console.log('后端返回数据:', resp.data);  // 加这行！打印真实数据\n            if (resp.data.message === \"ok\" || resp.data.code === 200) {\n              this.itemTotal = resp.data.data.total || resp.data.data.totalRecords;\n              this.goods = resp.data.data.records || resp.data.data.list;\n\n            }\n          })\n          .catch((error) => {\n            console.log(error);\n          });\n    },\n    handleSizeChange(limit) {\n      this.limit = limit;\n      this.currentPage = 1;\n      this.getGoods();\n    },\n    handleCurrentChange(val) {\n      this.currentPage = val;\n      this.getGoods();\n    },\n    search() {\n      this.currentPage = 1;\n      this.getGoods();\n    },\n    handleEdit(index, row) {\n      // 深拷贝，避免直接修改表格数据\n      this.goodsItem = {...row};\n      this.drawerEdit = true;\n    },\n    handleDelete(index, row) {\n      this.goodsItem = row;\n      this.$confirm(\"删除商品后不可恢复, 是否继续?\", \"提示\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\",\n      })\n          .then(() => {\n            const params = new URLSearchParams();\n            params.append(\"token\", this.token);\n            params.append(\"gid\", this.goodsItem.gid);\n\n            this.axios\n                .post(\"http://localhost:8888/goods/delete\", params, {\n                  headers: {\"Content-Type\": \"application/x-www-form-urlencoded\"},\n                })\n                .then((resp) => {\n                  this.$message.success(resp.data.message || \"删除成功\");\n                  this.getGoods();\n                })\n                .catch((error) => {\n                  console.error(error);\n                  this.$message.error(\"删除失败\");\n                });\n          })\n          .catch(() => {\n            this.$message.info(\"已取消删除\");\n          });\n    },\n    submitEdit() {\n      const params = new URLSearchParams();\n      params.append(\"token\", this.token);\n      params.append(\"gId\", this.goodsItem.gId);\n      params.append(\"gName\", this.goodsItem.gName);\n      params.append(\"gPrice\", this.goodsItem.gPrice);\n      params.append(\"gCount\", this.goodsItem.gCount);\n      params.append(\"gContent\", this.goodsItem.gContent || \"\");\n      params.append(\"gImage\", this.goodsItem.gImage || \"\");\n      params.append(\"uId\", this.goodsItem.uId);\n      params.append(\"gLevel\", this.goodsItem.gLevel || 0);\n      params.append(\"gContact\", this.goodsItem.gContact || \"\");\n      params.append(\"college\", this.goodsItem.college);\n      params.append(\"campus\", this.goodsItem.campus);\n      params.append(\"subject\", this.goodsItem.subject);\n      params.append(\"type\", this.goodsItem.type);\n\n\n\n      this.axios\n          .post(\"http://localhost:8888/goods/update\", params, {\n            headers: {\"Content-Type\": \"application/x-www-form-urlencoded\"},\n          })\n          .then((resp) => {\n            this.$message.success(resp.data.message || \"修改成功\");\n            this.drawerEdit = false;\n            this.getGoods();\n          })\n          .catch((error) => {\n            console.error(error);\n            this.$message.error(\"修改失败\");\n          })\n          .finally(() => {\n            this.goodsItem = {};\n          });\n    },\n    addGoods() {\n      // 重置表单和上传状态\n      this.goodsItem = {\n        gName: \"\",\n        gPrice: null,\n        gCount: null,\n        gContent: \"\",\n        gLevel: 4,\n        gContact: \"\",\n        college: \"\",\n        campus: \"\",\n        subject: \"\",\n        type: \"\"\n      };\n\n      this.fileList = [];\n      this.uploadFile = null;\n      this.drawerAdd = true;\n    },\n    // el-upload 相关方法\n    handleFileChange(file, fileList) {\n      this.uploadFile = file.raw;               // 保存原始文件对象\n      this.fileList = fileList.slice(-1);        // 限制只保留最后一张（最多1张）\n    },\n    handleRemove() {\n      this.uploadFile = null;\n      this.fileList = [];\n    },\n    handlePreview(file) {\n      this.previewUrl = file.url;\n      this.previewVisible = true;\n    },\n    submitAdd() {\n      // 基础校验\n      if (!this.goodsItem.gName || this.goodsItem.gPrice === null || this.goodsItem.gCount === null) {\n        this.$message.error(\"请填写商品名称、价格和数量\");\n        return;\n      }\n\n\n      this.adding = true;\n\n      const formData = new FormData();\n      formData.append(\"token\", this.token);\n      formData.append(\"gName\", this.goodsItem.gName);\n      formData.append(\"gPrice\", this.goodsItem.gPrice);\n      formData.append(\"gCount\", this.goodsItem.gCount);\n      formData.append(\"gContent\", this.goodsItem.gContent || \"\");\n      formData.append(\"gLevel\", this.goodsItem.gLevel || 4);\n      formData.append(\"gContact\", this.goodsItem.gContact);\n      formData.append(\"college\", this.goodsItem.college);\n      formData.append(\"campus\", this.goodsItem.campus);\n      formData.append(\"subject\", this.goodsItem.subject);\n      formData.append(\"type\", this.goodsItem.type);\n\n\n      if (this.uploadFile) {\n        formData.append(\"gImageFile\", this.uploadFile);\n      }\n\n      this.axios\n          .post(\"http://localhost:8888/goods/add\", formData, {\n            headers: {\"Content-Type\": \"multipart/form-data\"},\n          })\n          .then((resp) => {\n            if (resp.data.code === 200 || resp.data.message.includes(\"成功\")) {\n              this.$message.success(\"商品发布成功！\");\n              this.drawerAdd = false;\n              this.getGoods();\n            } else {\n              this.$message.error(resp.data.message || \"发布失败\");\n            }\n          })\n          .catch((error) => {\n            console.error(error);\n            this.$message.error(\"上传失败，请检查网络或图片大小\");\n          })\n          .finally(() => {\n            this.adding = false;\n            this.goodsItem = {};\n          });\n    },\n    deleteIds() {\n      if (this.ids.length === 0) {\n        this.$message.error(\"请先选择要删除的商品\");\n        return;\n      }\n\n      this.$confirm(`确定批量删除这 ${this.ids.length} 件商品吗？`, \"提示\", {\n        type: \"warning\",\n      })\n          .then(() => {\n            const params = new URLSearchParams();\n            params.append(\"token\", this.token);\n            this.ids.forEach((id) => params.append(\"listId\", id));\n\n            this.axios\n                .post(\"http://localhost:8888/goods/deleteById\", params, {\n                  headers: {\"Content-Type\": \"application/x-www-form-urlencoded\"},\n                })\n                .then((resp) => {\n                  this.$message.success(resp.data.message || \"批量删除成功\");\n                  this.getGoods();\n                })\n                .catch((error) => {\n                  console.error(error);\n                  this.$message.error(\"批量删除失败\");\n                });\n          })\n          .catch(() => {\n            this.$message.info(\"已取消批量删除\");\n          });\n    },\n  },\n};\n</script>\n\n<style>\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}